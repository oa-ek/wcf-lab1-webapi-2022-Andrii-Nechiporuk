@page "/login"
@inject HttpClient Http
@inject AuthenticationStateProvider AuthStateProvider
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation


<h3>Login</h3>

<EditForm Model="user" OnSubmit="HandleLogin">
	<label for="username">Name</label>
	<InputText id="username" @bind-Value="user.UserName"/>
	<label for="password">Password</label>
	<InputText id="password" @bind-Value="user.Password" type="password"/>
	<button type="submit" class="btn btn-success">Залогінитись</button>
</EditForm>


@code {
	UserLoginDto user = new UserLoginDto();

	async Task HandleLogin()
	{
		var result = await Http.PostAsJsonAsync("api/auth/login", user);
		var token = await result.Content.ReadAsStringAsync();
		if (result.IsSuccessStatusCode)
        {
			await LocalStorage.SetItemAsync("token", token);
			await AuthStateProvider.GetAuthenticationStateAsync();
			Navigation.NavigateTo("/");
        }

	}
}
